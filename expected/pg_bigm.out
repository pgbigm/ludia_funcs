\pset null '(null)'
-- Load pg_bigm and ludia_funcs
CREATE EXTENSION pg_bigm;
CREATE EXTENSION ludia_funcs;
-- Set parameters for the tests
SET standard_conforming_strings TO off;
SET escape_string_warning TO off;
SET work_mem = '4MB';
SET maintenance_work_mem TO '512MB';
SET enable_seqscan TO off;
SET enable_bitmapscan TO on;
-- Test the case where the columns with CHAR data type were indexed
-- with pg_bigm and pgs2norm function.
CREATE TABLE char_tbl (col1 char(256), col2 char(256), col3 char(256));
\copy char_tbl from data/test_tbl.txt
CREATE INDEX char_tbl_idx ON char_tbl USING gin (pgs2norm(col1) gin_bigm_ops,
                                                                   pgs2norm(col2) gin_bigm_ops,
                                                                   pgs2norm(col3) gin_bigm_ops)
                                                                   WITH (FASTUPDATE = off);
SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'v(æ ª)', col1) FROM char_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('v(æ ª)'))
    ORDER BY col1;
     pgs2snippet1      
-----------------------
 ãƒ­ï¾ŠAbï¼£ï½„1ï¼’â‘¢â˜…â…£ãˆ±â˜…');
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'â‘¡â“ª', col1) FROM char_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('â‘¡â“ª'))
    ORDER BY col1;
 pgs2snippet1  
---------------
 â˜… 20â˜…13.04.05
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾', col1) FROM char_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾'))
    ORDER BY col1;
      pgs2snippet1      
------------------------
 ãƒˆâ˜…ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³â˜…å´
(1 row)

-- Test the case where the columns with VARCHAR data type were indexed
-- with pg_bigm and pgs2norm function.
CREATE TABLE varchar_tbl (col1 varchar(256), col2 varchar(256), col3 varchar(256));
\copy varchar_tbl from data/test_tbl.txt
CREATE INDEX varchar_tbl_idx ON varchar_tbl USING gin (pgs2norm(col1) gin_bigm_ops,
                                                                           pgs2norm(col2) gin_bigm_ops,
                                                                           pgs2norm(col3) gin_bigm_ops)
                                                                           WITH (FASTUPDATE = off);
SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'v(æ ª)', col1) FROM varchar_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('v(æ ª)'))
    ORDER BY col1;
     pgs2snippet1      
-----------------------
 ãƒ­ï¾ŠAbï¼£ï½„1ï¼’â‘¢â˜…â…£ãˆ±â˜…');
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'â‘¡â“ª', col1) FROM varchar_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('â‘¡â“ª'))
    ORDER BY col1;
 pgs2snippet1  
---------------
 â˜… 20â˜…13.04.05
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾', col1) FROM varchar_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾'))
    ORDER BY col1;
      pgs2snippet1      
------------------------
 ãƒˆâ˜…ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³â˜…å´
(1 row)

-- Test the case where the columns with TEXT data type were indexed
-- with pg_bigm and pgs2norm function.
CREATE TABLE text_tbl (col1 text, col2 text, col3 text);
\copy text_tbl from data/test_tbl.txt
CREATE INDEX text_tbl_idx ON text_tbl USING gin (pgs2norm(col1) gin_bigm_ops,
                                                                  pgs2norm(col2) gin_bigm_ops,
                                                                  pgs2norm(col3) gin_bigm_ops)
                                                                  WITH (FASTUPDATE = off);
SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'v(æ ª)', col1) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('v(æ ª)'))
    ORDER BY col1;
     pgs2snippet1      
-----------------------
 ãƒ­ï¾ŠAbï¼£ï½„1ï¼’â‘¢â˜…â…£ãˆ±â˜…');
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'â‘¡â“ª', col1) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('â‘¡â“ª'))
    ORDER BY col1;
 pgs2snippet1  
---------------
 â˜… 20â˜…13.04.05
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾', col1) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾'))
    ORDER BY col1;
      pgs2snippet1      
------------------------
 ãƒˆâ˜…ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³â˜…å´
(1 row)

-- Test the case where condition has "AND".
SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col1) LIKE likequery(pgs2norm('è§£é‡ˆ')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('å®Ÿè£…')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('å ´åˆ'));
 count 
-------
     1
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col1) LIKE likequery(pgs2norm('è§£é‡ˆ')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('å®Ÿè£…')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('å ´åˆ'));
                                                                  QUERY PLAN                                                                  
----------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: ((pgs2norm(col1) ~~ '%è§£é‡ˆ%'::text) AND (pgs2norm(col1) ~~ '%å®Ÿè£…%'::text) AND (pgs2norm(col1) ~~ '%å ´åˆ%'::text))
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: ((pgs2norm(col1) ~~ '%è§£é‡ˆ%'::text) AND (pgs2norm(col1) ~~ '%å®Ÿè£…%'::text) AND (pgs2norm(col1) ~~ '%å ´åˆ%'::text))
(5 rows)

SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col1) LIKE likequery(pgs2norm('è§£é‡ˆ')) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('ï¾•ï½°ï½»ã‚›')) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('ï¼³ï½‘ï¼¬'));
 count 
-------
     1
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col1) LIKE likequery(pgs2norm('è§£é‡ˆ')) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('ï¾•ï½°ï½»ã‚›')) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('ï¼³ï½‘ï¼¬'));
                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: ((pgs2norm(col1) ~~ '%è§£é‡ˆ%'::text) AND (pgs2norm(col2) ~~ '%ãƒ¦ãƒ¼ã‚¶%'::text) AND (pgs2norm(col3) ~~ '%sql%'::text))
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: ((pgs2norm(col1) ~~ '%è§£é‡ˆ%'::text) AND (pgs2norm(col2) ~~ '%ãƒ¦ãƒ¼ã‚¶%'::text) AND (pgs2norm(col3) ~~ '%sql%'::text))
(5 rows)

-- Test the case where condition has "OR".
SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col2) LIKE likequery(pgs2norm('ï¾Šã‚œãƒ©ãƒ¡ãƒ¼ã‚¿')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('ã‰œ')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('  '));
 count 
-------
     9
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col2) LIKE likequery(pgs2norm('ï¾Šã‚œãƒ©ãƒ¡ãƒ¼ã‚¿')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('ã‰œ')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('  '));
                                                                QUERY PLAN                                                                
------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: ((pgs2norm(col2) ~~ '%ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿%'::text) OR (pgs2norm(col2) ~~ '%32%'::text) OR (pgs2norm(col2) ~~ '%  %'::text))
         ->  BitmapOr
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: (pgs2norm(col2) ~~ '%ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿%'::text)
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: (pgs2norm(col2) ~~ '%32%'::text)
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: (pgs2norm(col2) ~~ '%  %'::text)
(10 rows)

SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col1) LIKE likequery(pgs2norm('ï¾Šã‚œãƒ©ãƒ¡ãƒ¼ã‚¿')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('ã‰œ')) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('  '));
 count 
-------
    10
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col1) LIKE likequery(pgs2norm('ï¾Šã‚œãƒ©ãƒ¡ãƒ¼ã‚¿')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('ã‰œ')) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('  '));
                                                                QUERY PLAN                                                                
------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: ((pgs2norm(col1) ~~ '%ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿%'::text) OR (pgs2norm(col2) ~~ '%32%'::text) OR (pgs2norm(col3) ~~ '%  %'::text))
         ->  BitmapOr
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: (pgs2norm(col1) ~~ '%ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿%'::text)
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: (pgs2norm(col2) ~~ '%32%'::text)
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: (pgs2norm(col3) ~~ '%  %'::text)
(10 rows)

-- Test the case where condition has "NOT".
SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col3) LIKE likequery(pgs2norm('ludia')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('ãŠ')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('â“…'));
 count 
-------
    11
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col3) LIKE likequery(pgs2norm('ludia')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('ãŠ')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('â“…'));
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col3) ~~ '%ludia%'::text)
         Filter: ((pgs2norm(col3) !~~ '%æ—¥%'::text) AND (pgs2norm(col3) !~~ '%p%'::text))
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col3) ~~ '%ludia%'::text)
(6 rows)

SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col2) LIKE likequery(pgs2norm('ludia')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('ãŠ')) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('â“…'));
 count 
-------
     8
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    pgs2norm(col2) LIKE likequery(pgs2norm('ludia')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('ãŠ')) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('â“…'));
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col2) ~~ '%ludia%'::text)
         Filter: ((pgs2norm(col3) !~~ '%æ—¥%'::text) AND (pgs2norm(col1) !~~ '%p%'::text))
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col2) ~~ '%ludia%'::text)
(6 rows)

-- Test for text search with many conditions
SELECT count(*) FROM text_tbl WHERE
    (pgs2norm(col1) LIKE likequery(pgs2norm('æ–‡å­—')) AND
	pgs2norm(col1) LIKE likequery(pgs2norm('ç„¡åŠ¹')) AND
	pgs2norm(col1) NOT LIKE likequery(pgs2norm('è¨­å®š'))) OR
	(pgs2norm(col2) LIKE likequery(pgs2norm('æ–‡å­—')) AND
	pgs2norm(col2) LIKE likequery(pgs2norm('ç„¡åŠ¹')) AND
	pgs2norm(col2) NOT LIKE likequery(pgs2norm('è¨­å®š'))) OR
	(pgs2norm(col3) LIKE likequery(pgs2norm('æ–‡å­—')) AND
	pgs2norm(col3) LIKE likequery(pgs2norm('ç„¡åŠ¹')) AND
	pgs2norm(col3) NOT LIKE likequery(pgs2norm('è¨­å®š')));
 count 
-------
     1
(1 row)

EXPLAIN (costs off) SELECT count(*) FROM text_tbl WHERE
    (pgs2norm(col1) LIKE likequery(pgs2norm('æ–‡å­—')) AND
	pgs2norm(col1) LIKE likequery(pgs2norm('ç„¡åŠ¹')) AND
	pgs2norm(col1) NOT LIKE likequery(pgs2norm('è¨­å®š'))) OR
	(pgs2norm(col2) LIKE likequery(pgs2norm('æ–‡å­—')) AND
	pgs2norm(col2) LIKE likequery(pgs2norm('ç„¡åŠ¹')) AND
	pgs2norm(col2) NOT LIKE likequery(pgs2norm('è¨­å®š'))) OR
	(pgs2norm(col3) LIKE likequery(pgs2norm('æ–‡å­—')) AND
	pgs2norm(col3) LIKE likequery(pgs2norm('ç„¡åŠ¹')) AND
	pgs2norm(col3) NOT LIKE likequery(pgs2norm('è¨­å®š')));
                                                                                                                                                                                     QUERY PLAN                                                                                                                                                                                      
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (((pgs2norm(col1) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col1) ~~ '%ç„¡åŠ¹%'::text)) OR ((pgs2norm(col2) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col2) ~~ '%ç„¡åŠ¹%'::text)) OR ((pgs2norm(col3) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col3) ~~ '%ç„¡åŠ¹%'::text)))
         Filter: (((pgs2norm(col1) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col1) ~~ '%ç„¡åŠ¹%'::text) AND (pgs2norm(col1) !~~ '%è¨­å®š%'::text)) OR ((pgs2norm(col2) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col2) ~~ '%ç„¡åŠ¹%'::text) AND (pgs2norm(col2) !~~ '%è¨­å®š%'::text)) OR ((pgs2norm(col3) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col3) ~~ '%ç„¡åŠ¹%'::text) AND (pgs2norm(col3) !~~ '%è¨­å®š%'::text)))
         ->  BitmapOr
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: ((pgs2norm(col1) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col1) ~~ '%ç„¡åŠ¹%'::text))
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: ((pgs2norm(col2) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col2) ~~ '%ç„¡åŠ¹%'::text))
               ->  Bitmap Index Scan on text_tbl_idx
                     Index Cond: ((pgs2norm(col3) ~~ '%æ–‡å­—%'::text) AND (pgs2norm(col3) ~~ '%ç„¡åŠ¹%'::text))
(11 rows)

-- Test for UPDATE and DELETE
UPDATE text_tbl SET col1 = col2, col2 = col3, col3 = col1;
UPDATE text_tbl SET col1 = col2, col2 = col3, col3 = col1;
UPDATE text_tbl SET col1 = col2, col2 = col3, col3 = col1;
SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'v(æ ª)', col1) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('v(æ ª)'))
    ORDER BY col1;
     pgs2snippet1      
-----------------------
 ãƒ­ï¾ŠAbï¼£ï½„1ï¼’â‘¢â˜…â…£ãˆ±â˜…');
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'â‘¡â“ª', col1) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('â‘¡â“ª'))
    ORDER BY col1;
 pgs2snippet1  
---------------
 â˜… 20â˜…13.04.05
(1 row)

SELECT pgs2snippet1(1, 32, 1, 'â˜…', 'â˜…', 0, 'ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾', col1) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½±ï¾Œï¾Ÿï¾˜ï½¹ï½°ï½¼ï½®ï¾'))
    ORDER BY col1;
      pgs2snippet1      
------------------------
 ãƒˆâ˜…ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³â˜…å´
(1 row)

-- The text search for updated or deleted records must return no results
-- even when recheck is skipped on the text search.
EXPLAIN (costs off) UPDATE text_tbl SET col1 =
    (select string_agg(chr(num), '') from generate_series(ascii('ã‹'), ascii('ã‹¾')) num)
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ãŠ€'));
                         QUERY PLAN                         
------------------------------------------------------------
 Update on text_tbl
   InitPlan 1 (returns $0)
     ->  Aggregate
           ->  Function Scan on generate_series num
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%ä¸€%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%ä¸€%'::text)
(8 rows)

UPDATE text_tbl SET col1 =
    (select string_agg(chr(num), '') from generate_series(ascii('ã‹'), ascii('ã‹¾')) num)
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ãŠ€'));
SELECT count(*) FROM text_tbl WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ãŠ€'));
 count 
-------
     0
(1 row)

EXPLAIN (costs off) DELETE FROM text_tbl WHERE pgs2norm(col1) like likequery(pgs2norm('â‘¬'));
                         QUERY PLAN                         
------------------------------------------------------------
 Delete on text_tbl
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%13%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%13%'::text)
(5 rows)

DELETE FROM text_tbl WHERE pgs2norm(col1) like likequery(pgs2norm('â‘¬'));
SELECT count(*) FROM text_tbl WHERE pgs2norm(col1) like likequery(pgs2norm('â‘¬'));
 count 
-------
     0
(1 row)

-- Test whether both seq scan and bitmap scan return the same results
SET enable_seqscan to on;
SET enable_bitmapscan to off;
SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½å±±ç”°å¤ªéƒ'))
    ORDER BY col1;
     replace     
-----------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½ å±±ç”°å¤ªéƒ'))
    ORDER BY col1;
     replace     
-----------------
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½ å±±ç”° å¤ªéƒ'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'æ±äº¬éƒ½\tå±±ç”°å¤ªéƒ'))
    ORDER BY col1;
     replace     
-----------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('äº¬éƒ½å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(4 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('äº¬éƒ½ å±±ç”°'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('éƒ½ å±±ç”°'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('éƒ½ å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('  å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('äº¬éƒ½  '))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'éƒ½\t'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬ã¨äº¬éƒ½
 æ±äº¬éƒ½
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(9 rows)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ã€€'));
 count 
-------
    48
(1 row)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(' '));
 count 
-------
    48
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    ORDER BY col1;
     replace      
------------------
 å±±ç”°
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(8 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(' å±± '))
    ORDER BY col1;
 replace 
---------
(0 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ãƒ'))
    ORDER BY col1;
 replace 
---------
 ãƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï¾ï¾Ÿ'))
    ORDER BY col1;
 replace 
---------
 ãƒ
(1 row)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('A'));
 count 
-------
    30
(1 row)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('a'));
 count 
-------
    30
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('AA'))
    ORDER BY col1;
 replace 
---------
(0 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(8 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(7 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(7 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('ç”°'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(7 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    OR pgs2norm(col1) LIKE likequery(pgs2norm('ãƒ'))
    ORDER BY col1;
     replace      
------------------
 ãƒ
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(8 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½å±±ç”°å¤ªéƒ'))
    ORDER BY col1;
                          QUERY PLAN                          
--------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½å±±ç”°å¤ªéƒ%'::text)
(4 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½ å±±ç”° å¤ªéƒ'))
    ORDER BY col1;
                           QUERY PLAN                           
----------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½ å±±ç”° å¤ªéƒ%'::text)
(4 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'æ±äº¬éƒ½\tå±±ç”°å¤ªéƒ'))
    ORDER BY col1;
                          QUERY PLAN                          
--------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½å±±ç”°å¤ªéƒ%'::text)
(4 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('éƒ½ å±±ç”°'))
    ORDER BY col1;
                      QUERY PLAN                       
-------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '%éƒ½ å±±ç”°%'::text)
(4 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('  å±±'))
    ORDER BY col1;
                     QUERY PLAN                     
----------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '%  å±±%'::text)
(4 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'éƒ½\t'))
    ORDER BY col1;
                    QUERY PLAN                    
--------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '%éƒ½%'::text)
(4 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ã€€'))
    ORDER BY col1;
                   QUERY PLAN                    
-------------------------------------------------
 Sort
   Sort Key: col1
   ->  Seq Scan on text_tbl
         Filter: (pgs2norm(col1) ~~ '% %'::text)
(4 rows)

SET enable_seqscan to off;
SET enable_bitmapscan to on;
SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½å±±ç”°å¤ªéƒ'))
    ORDER BY col1;
     replace     
-----------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½ å±±ç”°å¤ªéƒ'))
    ORDER BY col1;
     replace     
-----------------
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½ å±±ç”° å¤ªéƒ'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'æ±äº¬éƒ½\tå±±ç”°å¤ªéƒ'))
    ORDER BY col1;
     replace     
-----------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('äº¬éƒ½å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(4 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('äº¬éƒ½ å±±ç”°'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('éƒ½ å±±ç”°'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('éƒ½ å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
(2 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('  å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('äº¬éƒ½  '))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'éƒ½\t'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬ã¨äº¬éƒ½
 æ±äº¬éƒ½
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(9 rows)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ã€€'));
 count 
-------
    48
(1 row)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(' '));
 count 
-------
    48
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    ORDER BY col1;
     replace      
------------------
 å±±ç”°
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(8 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(' å±± '))
    ORDER BY col1;
 replace 
---------
(0 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ãƒ'))
    ORDER BY col1;
 replace 
---------
 ãƒ
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï¾ï¾Ÿ'))
    ORDER BY col1;
 replace 
---------
 ãƒ
(1 row)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('A'));
 count 
-------
    30
(1 row)

SELECT count(*) FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('a'));
 count 
-------
    30
(1 row)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('AA'))
    ORDER BY col1;
 replace 
---------
(0 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(8 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(7 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(7 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('ç”°'))
    ORDER BY col1;
     replace      
------------------
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(7 rows)

SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½'))
    AND pgs2norm(col1) LIKE likequery(pgs2norm('å±±'))
    OR pgs2norm(col1) LIKE likequery(pgs2norm('ãƒ'))
    ORDER BY col1;
     replace      
------------------
 ãƒ
 æ±äº¬éƒ½*å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½  å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½ å±±ç”°å¤ªéƒ
 æ±äº¬éƒ½å±±ç”° å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°ã€€å¤ªéƒ
 æ±äº¬éƒ½å±±ç”°å¤ªéƒ
(8 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½å±±ç”°å¤ªéƒ'))
    ORDER BY col1;
                               QUERY PLAN                               
------------------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½å±±ç”°å¤ªéƒ%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½å±±ç”°å¤ªéƒ%'::text)
(6 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('æ±äº¬éƒ½ å±±ç”° å¤ªéƒ'))
    ORDER BY col1;
                                QUERY PLAN                                
--------------------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½ å±±ç”° å¤ªéƒ%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½ å±±ç”° å¤ªéƒ%'::text)
(6 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'æ±äº¬éƒ½\tå±±ç”°å¤ªéƒ'))
    ORDER BY col1;
                               QUERY PLAN                               
------------------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½å±±ç”°å¤ªéƒ%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%æ±äº¬éƒ½å±±ç”°å¤ªéƒ%'::text)
(6 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('éƒ½ å±±ç”°'))
    ORDER BY col1;
                           QUERY PLAN                            
-----------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%éƒ½ å±±ç”°%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%éƒ½ å±±ç”°%'::text)
(6 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('  å±±'))
    ORDER BY col1;
                          QUERY PLAN                          
--------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%  å±±%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%  å±±%'::text)
(6 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(E'éƒ½\t'))
    ORDER BY col1;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%éƒ½%'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%éƒ½%'::text)
(6 rows)

EXPLAIN (costs off) SELECT replace(col1, E'\t', '*') FROM text_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ã€€'))
    ORDER BY col1;
                        QUERY PLAN                         
-----------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on text_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '% %'::text)
         ->  Bitmap Index Scan on text_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '% %'::text)
(6 rows)

-- Test the case where a multi-column index is created on many columns
CREATE TABLE mc31_tbl (col1 text, col2 char(256), col3 varchar(256), col4 text,
    col5 char(256), col6 varchar(256), col7 text, col8 char(256),
    col9 varchar(256), col10 text, col11 char(256), col12 varchar(256),
    col13 text, col14 char(256), col15 varchar(256), col16 text,
    col17 char(256), col18 varchar(256), col19 text, col20 char(256),
    col21 varchar(256), col22 text, col23 char(256), col24 varchar(256),
    col25 text, col26 char(256), col27 varchar(256), col28 text,
    col29 char(256), col30 varchar(256), col31 text);
CREATE INDEX mc31_tbl_idx ON mc31_tbl USING gin (pgs2norm(col1) gin_bigm_ops,
    pgs2norm(col2) gin_bigm_ops, pgs2norm(col3) gin_bigm_ops,
    pgs2norm(col4) gin_bigm_ops, pgs2norm(col5) gin_bigm_ops,
    pgs2norm(col6) gin_bigm_ops, pgs2norm(col7) gin_bigm_ops,
    pgs2norm(col8) gin_bigm_ops, pgs2norm(col9) gin_bigm_ops,
    pgs2norm(col10) gin_bigm_ops, pgs2norm(col11) gin_bigm_ops,
    pgs2norm(col12) gin_bigm_ops, pgs2norm(col13) gin_bigm_ops,
    pgs2norm(col14) gin_bigm_ops, pgs2norm(col15) gin_bigm_ops,
    pgs2norm(col16) gin_bigm_ops, pgs2norm(col17) gin_bigm_ops,
    pgs2norm(col18) gin_bigm_ops, pgs2norm(col19) gin_bigm_ops,
    pgs2norm(col20) gin_bigm_ops, pgs2norm(col21) gin_bigm_ops,
    pgs2norm(col22) gin_bigm_ops, pgs2norm(col23) gin_bigm_ops,
    pgs2norm(col24) gin_bigm_ops, pgs2norm(col25) gin_bigm_ops,
    pgs2norm(col26) gin_bigm_ops, pgs2norm(col27) gin_bigm_ops,
    pgs2norm(col28) gin_bigm_ops, pgs2norm(col29) gin_bigm_ops,
    pgs2norm(col30) gin_bigm_ops, pgs2norm(col31) gin_bigm_ops)
    WITH (FASTUPDATE = off);
\copy mc31_tbl from 'data/test_tbl_31.txt'
SELECT col1 FROM mc31_tbl
    WHERE pgs2norm(col1) like likequery(pgs2norm('ï¼¿ï¼³'))
    ORDER BY col1;
                     col1                     
----------------------------------------------
 =# SHOW ludia_funcs.escape_snippet_keyword ;
(1 row)

EXPLAIN (costs off ) SELECT col1 FROM mc31_tbl
    WHERE pgs2norm(col1) like likequery(pgs2norm('ï¼¿ï¼³'))
    ORDER BY col1;
                          QUERY PLAN                          
--------------------------------------------------------------
 Sort
   Sort Key: col1
   ->  Bitmap Heap Scan on mc31_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%\\_s%'::text)
         ->  Bitmap Index Scan on mc31_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%\\_s%'::text)
(6 rows)

SELECT col15 FROM mc31_tbl
    WHERE pgs2norm(col15) LIKE likequery(pgs2norm('ï¾ƒã‚›ã‚£'))
    ORDER BY col15;
                                                                    col15                                                                     
----------------------------------------------------------------------------------------------------------------------------------------------
 â€¢--prefix : ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®šã—ã¾ã™ã€‚æœªæŒ‡å®šæ™‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã¯/usr/local/pgsqlã§ã™ã€‚ã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®šã¯å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
(1 row)

EXPLAIN (costs off ) SELECT col15 FROM mc31_tbl
    WHERE pgs2norm(col15) LIKE likequery(pgs2norm('ï¾ƒã‚›ã‚£'))
    ORDER BY col15;
                              QUERY PLAN                               
-----------------------------------------------------------------------
 Sort
   Sort Key: col15
   ->  Bitmap Heap Scan on mc31_tbl
         Recheck Cond: (pgs2norm((col15)::text) ~~ '%ãƒ‡ã‚£%'::text)
         ->  Bitmap Index Scan on mc31_tbl_idx
               Index Cond: (pgs2norm((col15)::text) ~~ '%ãƒ‡ã‚£%'::text)
(6 rows)

SELECT col31 FROM mc31_tbl
    WHERE pgs2norm(col31) LIKE likequery(pgs2norm('ãŠ”'))
    ORDER BY col31;
           col31            
----------------------------
 $ psql -d <ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å>
(1 row)

EXPLAIN (costs off) SELECT col31 FROM mc31_tbl
    WHERE pgs2norm(col31) LIKE likequery(pgs2norm('ãŠ”'))
    ORDER BY col31;
                         QUERY PLAN                          
-------------------------------------------------------------
 Sort
   Sort Key: col31
   ->  Bitmap Heap Scan on mc31_tbl
         Recheck Cond: (pgs2norm(col31) ~~ '%å%'::text)
         ->  Bitmap Index Scan on mc31_tbl_idx
               Index Cond: (pgs2norm(col31) ~~ '%å%'::text)
(6 rows)

-- Test the cases where various text search patterns are used.
CREATE TABLE abc_tbl (col1 text, col2 text, col3 text);
\copy abc_tbl from data/abc_data.tsv
CREATE INDEX abc_idx ON abc_tbl USING gin
    (pgs2norm(col1) gin_bigm_ops, pgs2norm(col2) gin_bigm_ops, pgs2norm(col3) gin_bigm_ops)
    WITH (FASTUPDATE = off);
SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   169
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   485
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   169
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   387
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   511
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   387
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) AND
    pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   169
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) OR
    pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   485
(1 row)

SELECT count(*) FROM abc_tbl WHERE
    ((pgs2norm(col1) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col1) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col2) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col2) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col2) LIKE likequery(pgs2norm('CCC'))) OR
    ((pgs2norm(col3) LIKE likequery(pgs2norm('AAA')) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('BBB'))) AND
    NOT pgs2norm(col3) LIKE likequery(pgs2norm('CCC')));
 count 
-------
   169
(1 row)

-- Test whether pg_bigm and pgs2norm can handle all the UTF8 characters
CREATE UNLOGGED TABLE utf8_tbl (code int, col1 text);
INSERT INTO utf8_tbl VALUES (-1, NULL);
INSERT INTO utf8_tbl VALUES (0, '');
INSERT INTO utf8_tbl SELECT code, repeat(chr(code), 3) FROM generate_series(1, 55295) code;
INSERT INTO utf8_tbl SELECT code, repeat(chr(code), 3) FROM generate_series(57344, 1114111) code;
CREATE INDEX utf8_tbl_idx ON utf8_tbl USING gin (pgs2norm(col1) gin_bigm_ops)
    WITH (FASTUPDATE = off);
-- Test for multi-byte, single-byte, upper-case and lower-case alphabet characters
SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('aa')) ORDER BY code;
  code  |  col1  
--------+--------
     65 | AAA
     97 | aaa
    170 | ÂªÂªÂª
   7468 | á´¬á´¬á´¬
   7491 | áµƒáµƒáµƒ
   8336 | â‚â‚â‚
   9398 | â’¶â’¶â’¶
   9424 | â“â“â“
  65313 | ï¼¡ï¼¡ï¼¡
  65345 | ï½ï½ï½
 119808 | ğ€ğ€ğ€
 119834 | ğšğšğš
 119860 | ğ´ğ´ğ´
 119886 | ğ‘ğ‘ğ‘
 119912 | ğ‘¨ğ‘¨ğ‘¨
 119938 | ğ’‚ğ’‚ğ’‚
 119964 | ğ’œğ’œğ’œ
 119990 | ğ’¶ğ’¶ğ’¶
 120016 | ğ“ğ“ğ“
 120042 | ğ“ªğ“ªğ“ª
 120068 | ğ”„ğ”„ğ”„
 120094 | ğ”ğ”ğ”
 120120 | ğ”¸ğ”¸ğ”¸
 120146 | ğ•’ğ•’ğ•’
 120172 | ğ•¬ğ•¬ğ•¬
 120198 | ğ–†ğ–†ğ–†
 120224 | ğ– ğ– ğ– 
 120250 | ğ–ºğ–ºğ–º
 120276 | ğ—”ğ—”ğ—”
 120302 | ğ—®ğ—®ğ—®
 120328 | ğ˜ˆğ˜ˆğ˜ˆ
 120354 | ğ˜¢ğ˜¢ğ˜¢
 120380 | ğ˜¼ğ˜¼ğ˜¼
 120406 | ğ™–ğ™–ğ™–
 120432 | ğ™°ğ™°ğ™°
 120458 | ğšŠğšŠğšŠ
(36 rows)

SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('BB')) ORDER BY code;
  code  |  col1  
--------+--------
     66 | BBB
     98 | bbb
   7470 | á´®á´®á´®
   7495 | áµ‡áµ‡áµ‡
   8492 | â„¬â„¬â„¬
   9399 | â’·â’·â’·
   9425 | â“‘â“‘â“‘
  65314 | ï¼¢ï¼¢ï¼¢
  65346 | ï½‚ï½‚ï½‚
 119809 | ğğğ
 119835 | ğ›ğ›ğ›
 119861 | ğµğµğµ
 119887 | ğ‘ğ‘ğ‘
 119913 | ğ‘©ğ‘©ğ‘©
 119939 | ğ’ƒğ’ƒğ’ƒ
 119991 | ğ’·ğ’·ğ’·
 120017 | ğ“‘ğ“‘ğ“‘
 120043 | ğ“«ğ“«ğ“«
 120069 | ğ”…ğ”…ğ”…
 120095 | ğ”Ÿğ”Ÿğ”Ÿ
 120121 | ğ”¹ğ”¹ğ”¹
 120147 | ğ•“ğ•“ğ•“
 120173 | ğ•­ğ•­ğ•­
 120199 | ğ–‡ğ–‡ğ–‡
 120225 | ğ–¡ğ–¡ğ–¡
 120251 | ğ–»ğ–»ğ–»
 120277 | ğ—•ğ—•ğ—•
 120303 | ğ—¯ğ—¯ğ—¯
 120329 | ğ˜‰ğ˜‰ğ˜‰
 120355 | ğ˜£ğ˜£ğ˜£
 120381 | ğ˜½ğ˜½ğ˜½
 120407 | ğ™—ğ™—ğ™—
 120433 | ğ™±ğ™±ğ™±
 120459 | ğš‹ğš‹ğš‹
(34 rows)

SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½ƒï½ƒ')) ORDER BY code;
  code  |  col1  
--------+--------
     67 | CCC
     99 | ccc
   7580 | á¶œá¶œá¶œ
   8450 | â„‚â„‚â„‚
   8493 | â„­â„­â„­
   8557 | â…­â…­â…­
   8573 | â…½â…½â…½
   9400 | â’¸â’¸â’¸
   9426 | â“’â“’â“’
  13252 | ã„ã„ã„
  65315 | ï¼£ï¼£ï¼£
  65347 | ï½ƒï½ƒï½ƒ
 119810 | ğ‚ğ‚ğ‚
 119836 | ğœğœğœ
 119862 | ğ¶ğ¶ğ¶
 119888 | ğ‘ğ‘ğ‘
 119914 | ğ‘ªğ‘ªğ‘ª
 119940 | ğ’„ğ’„ğ’„
 119966 | ğ’ğ’ğ’
 119992 | ğ’¸ğ’¸ğ’¸
 120018 | ğ“’ğ“’ğ“’
 120044 | ğ“¬ğ“¬ğ“¬
 120096 | ğ” ğ” ğ” 
 120148 | ğ•”ğ•”ğ•”
 120174 | ğ•®ğ•®ğ•®
 120200 | ğ–ˆğ–ˆğ–ˆ
 120226 | ğ–¢ğ–¢ğ–¢
 120252 | ğ–¼ğ–¼ğ–¼
 120278 | ğ—–ğ—–ğ—–
 120304 | ğ—°ğ—°ğ—°
 120330 | ğ˜Šğ˜Šğ˜Š
 120356 | ğ˜¤ğ˜¤ğ˜¤
 120382 | ğ˜¾ğ˜¾ğ˜¾
 120408 | ğ™˜ğ™˜ğ™˜
 120434 | ğ™²ğ™²ğ™²
 120460 | ğšŒğšŒğšŒ
(36 rows)

SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï¼¤ï¼¤')) ORDER BY code;
  code  |  col1  
--------+--------
     68 | DDD
    100 | ddd
   7472 | á´°á´°á´°
   7496 | áµˆáµˆáµˆ
   8517 | â……â……â……
   8518 | â…†â…†â…†
   8558 | â…®â…®â…®
   8574 | â…¾â…¾â…¾
   9401 | â’¹â’¹â’¹
   9427 | â““â““â““
  65316 | ï¼¤ï¼¤ï¼¤
  65348 | ï½„ï½„ï½„
 119811 | ğƒğƒğƒ
 119837 | ğğğ
 119863 | ğ·ğ·ğ·
 119889 | ğ‘‘ğ‘‘ğ‘‘
 119915 | ğ‘«ğ‘«ğ‘«
 119941 | ğ’…ğ’…ğ’…
 119967 | ğ’Ÿğ’Ÿğ’Ÿ
 119993 | ğ’¹ğ’¹ğ’¹
 120019 | ğ““ğ““ğ““
 120045 | ğ“­ğ“­ğ“­
 120071 | ğ”‡ğ”‡ğ”‡
 120097 | ğ”¡ğ”¡ğ”¡
 120123 | ğ”»ğ”»ğ”»
 120149 | ğ••ğ••ğ••
 120175 | ğ•¯ğ•¯ğ•¯
 120201 | ğ–‰ğ–‰ğ–‰
 120227 | ğ–£ğ–£ğ–£
 120253 | ğ–½ğ–½ğ–½
 120279 | ğ——ğ——ğ——
 120305 | ğ—±ğ—±ğ—±
 120331 | ğ˜‹ğ˜‹ğ˜‹
 120357 | ğ˜¥ğ˜¥ğ˜¥
 120383 | ğ˜¿ğ˜¿ğ˜¿
 120409 | ğ™™ğ™™ğ™™
 120435 | ğ™³ğ™³ğ™³
 120461 | ğšğšğš
(38 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('aa')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%aa%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%aa%'::text)
(6 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('BB')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%bb%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%bb%'::text)
(6 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½ƒï½ƒ')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%cc%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%cc%'::text)
(6 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï¼¤ï¼¤')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%dd%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%dd%'::text)
(6 rows)

-- Test for multi-byte, single-byte numbers
SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('11')) ORDER BY code;
  code  |  col1  
--------+--------
     49 | 111
    185 | Â¹Â¹Â¹
   8321 | â‚â‚â‚
   9312 | â‘ â‘ â‘ 
   9322 | â‘ªâ‘ªâ‘ª
   9342 | â‘¾â‘¾â‘¾
   9362 | â’’â’’â’’
  13002 | ã‹Šã‹Šã‹Š
  13155 | ã£ã£ã£
  13290 | ãªãªãª
  65297 | ï¼‘ï¼‘ï¼‘
 120783 | ğŸğŸğŸ
 120793 | ğŸ™ğŸ™ğŸ™
 120803 | ğŸ£ğŸ£ğŸ£
 120813 | ğŸ­ğŸ­ğŸ­
 120823 | ğŸ·ğŸ·ğŸ·
(16 rows)

SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï¼’ï¼’')) ORDER BY code;
  code  |  col1  
--------+--------
     50 | 222
    178 | Â²Â²Â²
   8322 | â‚‚â‚‚â‚‚
   9313 | â‘¡â‘¡â‘¡
  12882 | ã‰’ã‰’ã‰’
  13166 | ã®ã®ã®
  13301 | ãµãµãµ
  65298 | ï¼’ï¼’ï¼’
 120784 | ğŸğŸğŸ
 120794 | ğŸšğŸšğŸš
 120804 | ğŸ¤ğŸ¤ğŸ¤
 120814 | ğŸ®ğŸ®ğŸ®
 120824 | ğŸ¸ğŸ¸ğŸ¸
(13 rows)

SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('â‘¢â‘¢')) ORDER BY code;
  code  |  col1  
--------+--------
     51 | 333
    179 | Â³Â³Â³
   8323 | â‚ƒâ‚ƒâ‚ƒ
   9314 | â‘¢â‘¢â‘¢
  12893 | ã‰ã‰ã‰
  65299 | ï¼“ï¼“ï¼“
 120785 | ğŸ‘ğŸ‘ğŸ‘
 120795 | ğŸ›ğŸ›ğŸ›
 120805 | ğŸ¥ğŸ¥ğŸ¥
 120815 | ğŸ¯ğŸ¯ğŸ¯
 120825 | ğŸ¹ğŸ¹ğŸ¹
(11 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('11')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%11%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%11%'::text)
(6 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï¼’ï¼’')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%22%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%22%'::text)
(6 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('â‘¢â‘¢')) ORDER BY code;
                         QUERY PLAN                         
------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%33%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%33%'::text)
(6 rows)

-- Test for Japanese katakana
SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½±ï½±')) ORDER BY code;
 code  |  col1  
-------+--------
 12450 | ã‚¢ã‚¢ã‚¢
 13008 | ã‹ã‹ã‹
 13058 | ãŒ‚ãŒ‚ãŒ‚
 65393 | ï½±ï½±ï½±
(4 rows)

SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ã‚¤ã‚¤')) ORDER BY code;
 code  |  col1  
-------+--------
 12452 | ã‚¤ã‚¤ã‚¤
 13009 | ã‹‘ã‹‘ã‹‘
 65394 | ï½²ï½²ï½²
(3 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ï½±ï½±')) ORDER BY code;
                          QUERY PLAN                          
--------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%ã‚¢ã‚¢%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%ã‚¢ã‚¢%'::text)
(6 rows)

EXPLAIN (costs off) SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm('ã‚¤ã‚¤')) ORDER BY code;
                          QUERY PLAN                          
--------------------------------------------------------------
 Sort
   Sort Key: code
   ->  Bitmap Heap Scan on utf8_tbl
         Recheck Cond: (pgs2norm(col1) ~~ '%ã‚¤ã‚¤%'::text)
         ->  Bitmap Index Scan on utf8_tbl_idx
               Index Cond: (pgs2norm(col1) ~~ '%ã‚¤ã‚¤%'::text)
(6 rows)

-- Text for NULL
SELECT * FROM utf8_tbl
    WHERE pgs2norm(col1) LIKE likequery(pgs2norm(NULL)) ORDER BY code;
 code | col1 
------+------
(0 rows)

